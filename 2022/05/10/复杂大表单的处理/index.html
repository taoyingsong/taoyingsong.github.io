<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="不积跬步，无以至千里;不积小流，无以成江河。 文章我就喜欢读长的，表单我也要处理大的。 近一年先后经历过的两个项目都有大的复杂表单处理需求。 走过路过，没有错过，借着经验留下点足迹。">
<meta property="og:type" content="article">
<meta property="og:title" content="复杂大表单的处理">
<meta property="og:url" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/index.html">
<meta property="og:site_name" content="路漫漫其修远兮&lt;br &#x2F;&gt;吾将上下而求索">
<meta property="og:description" content="不积跬步，无以至千里;不积小流，无以成江河。 文章我就喜欢读长的，表单我也要处理大的。 近一年先后经历过的两个项目都有大的复杂表单处理需求。 走过路过，没有错过，借着经验留下点足迹。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/1.png">
<meta property="og:image" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/2.png">
<meta property="og:image" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/3.png">
<meta property="og:image" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/4.png">
<meta property="article:published_time" content="2022-05-10T06:13:35.000Z">
<meta property="article:modified_time" content="2022-05-10T06:47:33.749Z">
<meta property="article:author" content="taoyingsong">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/1.png">

<link rel="canonical" href="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>复杂大表单的处理 | 路漫漫其修远兮<br />吾将上下而求索</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">路漫漫其修远兮<br />吾将上下而求索</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="taoyingsong">
      <meta itemprop="description" content="本博客内容不定期对平时总结的知识进行汇总，交流探讨可+ 微信：StevenTao_">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路漫漫其修远兮<br />吾将上下而求索">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          复杂大表单的处理
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-10 14:13:35 / 修改时间：14:47:33" itemprop="dateCreated datePublished" datetime="2022-05-10T14:13:35+08:00">2022-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>不积跬步，无以至千里;不积小流，无以成江河。 文章我就喜欢读长的，表单我也要处理大的。 近一年先后经历过的两个项目都有大的复杂表单处理需求。 走过路过，没有错过，借着经验留下点足迹。</p>
<span id="more"></span>
<p>提纲：</p>
<ul>
<li>问题</li>
<li>怎么做</li>
<li>举证</li>
<li>代码编写过程和过程中发现&amp;处理的问题</li>
<li>升级为Hooks方案后需要的改进</li>
<li>总结</li>
</ul>
<p>表单处理是前端比较常见的需求，尤其是B端。表单处理大概可以分为基础表单（常见于数据项较少的表单场景）、分步表单（将一个冗长或用户不熟悉的表单任务分成多个步骤，指导用户完成）、比较复杂的高级大表单（根据开发业务的需要，进行大批量的、类型繁杂的数据处理表单）。这里结合我做的项目，介绍下比较复杂的大表单怎么处理。</p>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>当表单项足够多时我们可以选择分步表单处理，但是当表单项之间关联或者说联动也比较多时就不是简单的通过分步就能化繁为简的了。我处理的项目多是不能通过分步简化的，所以就有了处理复杂大表单的需要。<br>那么如何实现一个可拆分复用、易操作伸缩、能组合通用的复杂大表单？</p>
<h1 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h1><p><strong>可拆分复用：</strong> 大表单首先必须要能进行拆分，我们通过一套自定义约定来进行父子组件的通讯，以满足拆分复用的需要。这里我们约定父组件调用子组件时要传入values &amp; onChange属性，作为子组件的渲染数据和父子组件通信函数使用。拆出来的公共部分就可以复用。</p>
<p><strong>易操作伸缩：</strong> 复杂表单数据处理的过程中经常需要Modal或者Drawer的协助，我们可以把Modal或者Drawer中的表单元素用所用组件库的Form组件进行包裹，让这个Form收缩成父组件的元素——我称之为Form as Form.Item，这样就不用每次子组件某个数据变更时都onChange通知父组件了。我们可以在对Modal或者Drawer进行确定、提交操作时，在父组件中通过Form引用获取子组件的Form数据，这在代码逻辑上更加易于操作。当然Modal或者Drawer本身包含的是最外层的表单不用。</p>
<p><strong>能组合通用：</strong> 需要我们能把拆分的组件或者组件库组件根据需要组合成一个新的组件后，仍能按照上边两条进行操作处理。其实这个过程最终会变成父组件对子组件传递的各种情况数据的支持，需要父组件能通配处理简单的原始类型、普通对象、普通数组、组合的复杂对象数组等。</p>
<h1 id="举证"><a href="#举证" class="headerlink" title="举证"></a>举证</h1><h2 id="可拆分复用："><a href="#可拆分复用：" class="headerlink" title="可拆分复用："></a>可拆分复用：</h2><p>下边为摘出来的部分模块需求，我们拆分出来了规格列表SpecList组件，父组件调用时传入了渲染数据（供初始化或者数据变更渲染）和通信函数（onChange），子组件在数据变更时调用通信函数，数据到了父组件可以继续向上，层层反馈到最终的Form供表单提交使用，也可以用于和其他组件作数据联动（这个组件其实就和下边的SkuTable组件有联动），拆出来的组件有需要可以在多个地方复用。<br><img src="/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/1.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SpecList组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">handleDeleteItem = <span class="function"><span class="params">removeItem</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; attributes &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">      <span class="keyword">const</span> newAttributes = attributes.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">key</span> !== removeItem.<span class="property">key</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">attributes</span>: newAttributes &#125;)</span><br><span class="line">      <span class="keyword">const</span> &#123; onChange &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        <span class="title function_">onChange</span>(newAttributes)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handleSubmitItem = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; attributes, currentItem, attributeList &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> &#123; form &#125; = <span class="variable language_">this</span>.<span class="property">formRef</span>.<span class="property">props</span></span><br><span class="line">    form.<span class="title function_">validateFields</span>(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; specCategory, keys, specs &#125; = values</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">const</span> &#123; onChange &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        <span class="title function_">onChange</span>(newAttributes)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span> <span class="attr">bordered</span>=<span class="string">&#123;false&#125;</span> <span class="attr">bodyStyle</span>=<span class="string">&#123;&#123;</span> <span class="attr">paddingLeft:</span> <span class="attr">0</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;attributes.length &lt; 3 ? (</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;dashed&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;, <span class="attr">marginBottom:</span> <span class="attr">8</span> &#125;&#125; <span class="attr">icon</span>=<span class="string">&quot;plus&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleNewItem&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        添加规格类别</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    ) : (</span></span><br><span class="line"><span class="language-xml">      &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">    )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">size</span>=<span class="string">&quot;large&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">rowKey</span>=<span class="string">&quot;id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">dataSource</span>=<span class="string">&#123;attributes&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      // <span class="attr">itemLayout</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">renderItem</span>=<span class="string">&#123;(item,</span> <span class="attr">index</span>) =&gt;</span> (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">List.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">key</span>=<span class="string">&#123;index&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">actions</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &lt;<span class="attr">a</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleEditItem(item,</span> <span class="attr">index</span>)&#125;&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span>,</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Popconfirm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">title</span>=<span class="string">&quot;删除该规格后，当前的规格相关数据将丢失，确认要删除吗？&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onConfirm</span>=<span class="string">&#123;this.handleDeleteItem(item)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">okText</span>=<span class="string">&quot;确定&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">a</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span>,</span></span><br><span class="line"><span class="language-xml">          ]&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ListContent</span> <span class="attr">data</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">destroyOnClose</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">visible</span>=<span class="string">&#123;dialogVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">title</span>=<span class="string">&quot;编辑规格&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onOk</span>=<span class="string">&#123;this.handleSubmitItem&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onCancel</span>=<span class="string">&#123;this.handleCancelSubmit&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;800&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SpecEditor</span> <span class="attr">initialValue</span>=<span class="string">&#123;&#123;</span> <span class="attr">currentItem</span>, <span class="attr">attributeList</span> &#125;&#125; <span class="attr">wrappedComponentRef</span>=<span class="string">&#123;this.saveFormRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>父组件调用 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Form</span>.<span class="property">Item</span> label=<span class="string">&quot;规格&quot;</span>&gt;</span><br><span class="line">  &#123;<span class="title function_">getFieldDecorator</span>(<span class="string">&#x27;specList&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">initialValue</span>: [],</span><br><span class="line">    <span class="attr">rules</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请添加规格类型&#x27;</span> &#125;],</span><br><span class="line">  &#125;)(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;attributes &amp;&amp; attributes.length === 0 ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.toggleSpec&#125;</span>&gt;</span>取消添加规格<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SpecList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">attributes</span>=<span class="string">&#123;attributes&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">attributeList</span>=<span class="string">&#123;attributeList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;this.handleSpecListChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/<span class="title class_">Form</span>.<span class="property">Item</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="易操作伸缩："><a href="#易操作伸缩：" class="headerlink" title="易操作伸缩："></a>易操作伸缩：</h2><p>上边SpecList组件中的Modal包裹了这个组件，点击确定或者提交时，Modal就可以在onOk属性定义的this.handleSubmitItem函数的调用中，通过引用获取下边SpecEditor组件里Form表单的内容。弹窗里边的Form就相当于收缩成了外边Form的Form.Item，有拆解需要的拆解as Form.Item的Form就是伸展过程。<br><img src="/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/2.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SpecEditor组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span> <span class="attr">bordered</span>=<span class="string">&#123;false&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;规格分类&quot;</span> <span class="attr">hasFeedback</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;getFieldDecorator(&#x27;specCategory&#x27;, &#123;</span></span><br><span class="line"><span class="language-xml">          initialValue: specCategory,</span></span><br><span class="line"><span class="language-xml">        &#125;)(</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Select</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">60</span>%&#x27;, <span class="attr">marginRight:</span> <span class="attr">8</span> &#125;&#125; <span class="attr">placeholder</span>=<span class="string">&quot;请选择&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;attributeList &amp;&amp;</span></span><br><span class="line"><span class="language-xml">              attributeList.map(item =&gt; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;item.name&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              ))&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;添加图片&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;getFieldDecorator(&#x27;isAddPicture&#x27;, &#123; valuePropName: &#x27;checked&#x27;, initialValue: isAddPicture &#125;)(</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Switch</span> <span class="attr">disabled</span>=<span class="string">&#123;!canAddPicture&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;formItems&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;dashed&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.add&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">60</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&quot;plus&quot;</span> /&gt;</span> 添加规格</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Modal</span> <span class="attr">visible</span>=<span class="string">&#123;previewVisible&#125;</span> <span class="attr">footer</span>=<span class="string">&#123;null&#125;</span> <span class="attr">onCancel</span>=<span class="string">&#123;this.handleCancel&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;example&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27; &#125;&#125; <span class="attr">src</span>=<span class="string">&#123;previewImage&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="能组合通用："><a href="#能组合通用：" class="headerlink" title="能组合通用："></a>能组合通用：</h2><p>下边Table是由<code>&lt;InputNumber /&gt;</code>、<code>&lt;Input /&gt;</code>、<code>&lt;Select /&gt;</code>等组成，Table产生的数据是由对象组成的数组，对象由字符串、数字组成。当子组件产生其他形式的数据组合时，父组同样可以处理，这样的组合可以非常灵活，任何你想要的组件或者数据的组合都可以得到支持。<br><img src="/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/3.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SkuTable 组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">getColumns = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderCurrentPrice</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">InputNumber</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">autoFocus</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">min</span>=<span class="string">&#123;0&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">precision</span>=<span class="string">&#123;2&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;value</span> =&gt;</span> this.handleFieldChange(value, &#x27;currentPrice&#x27;, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">            onKeyPress=&#123;e =&gt; this.handleKeyPress(e, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderOriginalPrice</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">InputNumber</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">min</span>=<span class="string">&#123;0&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">precision</span>=<span class="string">&#123;2&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;value</span> =&gt;</span> this.handleFieldChange(value, &#x27;originalPrice&#x27;, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">            onKeyPress=&#123;e =&gt; this.handleKeyPress(e, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderStock</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">InputNumber</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">min</span>=<span class="string">&#123;0&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">precision</span>=<span class="string">&#123;0&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;value</span> =&gt;</span> this.handleFieldChange(value, &#x27;stock&#x27;, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">            onKeyPress=&#123;e =&gt; this.handleKeyPress(e, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderSkuCode</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> this.handleFieldChange(e.target.value, &#x27;skuCode&#x27;, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">            onKeyPress=&#123;e =&gt; this.handleKeyPress(e, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderActions</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; loading &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">      <span class="keyword">if</span> (!!record.<span class="property">editable</span> &amp;&amp; loading) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (record.<span class="property">isNew</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.saveRow(e, record.key)&#125;&gt;添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Popconfirm</span> <span class="attr">title</span>=<span class="string">&quot;是否要删除此行？&quot;</span> <span class="attr">onConfirm</span>=<span class="string">&#123;()</span> =&gt;</span> this.remove(record.key)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">a</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.saveRow(e, record.key)&#125;&gt;保存<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.cancel(e, record.key)&#125;&gt;取消<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.toggleEditable(e, record.key)&#125;&gt;编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Popconfirm</span> <span class="attr">title</span>=<span class="string">&quot;是否要删除此行？&quot;</span> <span class="attr">onConfirm</span>=<span class="string">&#123;()</span> =&gt;</span> this.remove(record.key)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderSpecField</span> = (<span class="params">text, record, item, index</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;value</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              // `specList[$&#123;index&#125;].attributeValueName`</span></span><br><span class="line"><span class="language-xml">              this.handleFieldChange(value, index, record.key)</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            &#123;item.keys.map(key =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.specs[key].specName&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.specs[key].specName&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;item.specs[key].specName&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">renderWeight</span> = (<span class="params">text, record</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (record.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">InputNumber</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">min</span>=<span class="string">&#123;0&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">precision</span>=<span class="string">&#123;2&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;value</span> =&gt;</span> this.handleFieldChange(value, &#x27;weight&#x27;, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">            onKeyPress=&#123;e =&gt; this.handleKeyPress(e, record.key)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;* 现价&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;currentPrice&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;currentPrice&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">render</span>: renderCurrentPrice,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;原价&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;originalPrice&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;originalPrice&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">render</span>: renderOriginalPrice,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;* 库存&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;stock&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;stock&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">render</span>: renderStock,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;商品编码&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;skuCode&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;skuCode&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">150</span>,</span><br><span class="line">        <span class="attr">render</span>: renderSkuCode,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;action&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">120</span>,</span><br><span class="line">        <span class="attr">render</span>: renderActions,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getColumn specList: &#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">data</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">specList</span>)</span><br><span class="line">    <span class="comment">// 循环规格列表将每个规格项插入columns，</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">specList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 遍历的是规格类别</span></span><br><span class="line">      <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="keyword">const</span> columnItem = &#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">`*<span class="subst">$&#123;item.specCategory&#125;</span>`</span>,</span><br><span class="line">          <span class="attr">dataIndex</span>: <span class="string">`specList[<span class="subst">$&#123;index&#125;</span>].attributeValueName`</span>, <span class="comment">// 对应的skus中的specList</span></span><br><span class="line">          <span class="attr">key</span>: index,</span><br><span class="line">          <span class="attr">width</span>: <span class="number">160</span>,</span><br><span class="line">          <span class="attr">render</span>: <span class="function">(<span class="params">text, record</span>) =&gt;</span> <span class="title function_">renderSpecField</span>(text, record, item, index),</span><br><span class="line">        &#125;</span><br><span class="line">        columns.<span class="title function_">unshift</span>(columnItem)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据运费在倒数第二个插入列</span></span><br><span class="line">    <span class="keyword">const</span> &#123; isWeightItemShow &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">    <span class="keyword">if</span> (isWeightItemShow) &#123;</span><br><span class="line">      <span class="comment">// 在倒数第二列插入重量</span></span><br><span class="line">      columns.<span class="title function_">splice</span>(columns.<span class="property">length</span> - <span class="number">1</span>, <span class="number">0</span>, &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;* 重量&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;weight&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;weight&#x27;</span>,</span><br><span class="line">        <span class="attr">render</span>: renderWeight,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> columns</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; loading, data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">loading</span>=<span class="string">&#123;loading&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">columns</span>=<span class="string">&#123;this.getColumns()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">dataSource</span>=<span class="string">&#123;data&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">pagination</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rowClassName</span>=<span class="string">&#123;record</span> =&gt;</span> (record.editable ? &#x27;editable&#x27; : &#x27;&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;, <span class="attr">marginTop:</span> <span class="attr">16</span>, <span class="attr">marginBottom:</span> <span class="attr">8</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;dashed&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.newItem&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">icon</span>=<span class="string">&quot;plus&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          新增一项</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>父组件的调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Form</span>.<span class="property">Item</span> label=<span class="string">&quot;价格与库存&quot;</span>&gt;</span><br><span class="line">  &#123;<span class="title function_">getFieldDecorator</span>(<span class="string">&#x27;skuTable&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">initialValue</span>: [],</span><br><span class="line">    <span class="attr">rules</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请添加、保存信息&#x27;</span> &#125;],</span><br><span class="line">  &#125;)(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">SkuTable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">specList</span>=<span class="string">&#123;attributes&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">skus</span>=<span class="string">&#123;skus&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">isWeightItemShow</span>=<span class="string">&#123;isWeightItemShow&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onChange</span>=<span class="string">&#123;this.handleSkuTableChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/<span class="title class_">Form</span>.<span class="property">Item</span>&gt;</span><br></pre></td></tr></table></figure>
<h1 id="代码编写过程和过程中发现-amp-处理的问题"><a href="#代码编写过程和过程中发现-amp-处理的问题" class="headerlink" title="代码编写过程和过程中发现&amp;处理的问题"></a>代码编写过程和过程中发现&amp;处理的问题</h1><ol>
<li>拆分组件：比如上边拆分的SpecList规格组件，SkuTable价格与库存组件，SpecEditor组件等</li>
<li>初始化组件：需要后台数据做初始化的，请求后台接口，获取到数据后把数据拆合处理成前端需要结构的数据，再分配到对应的组件，不需要的传空数据或者视情况传递需要的数据</li>
<li>拆分的组件对各自的数据做个性化处理<br><strong>案例：</strong><br>SkuTable 组件产生数据是个list，处理list item数据时触发的动作有：编辑、删除；添加、删除；保存、取消</li>
<li>和父组件通信：拆分的组件，更新数据时，验证通过后通知父组件(onChange)；删除、编辑数据（会更新数据的编辑状态）时通知父组件(onChange)，父组件收到数据后作进一步的传递和联动，未拆分组件部分的数据在总表单提交时获取。</li>
<li>提交表单：汇总表单未拆分出组件部分和拆件为组件部分的数据，作必要的校验，按接口结构组合数据，发起请求，重置表单等。</li>
</ol>
<p><strong>问题1：</strong> 上边动作的处理过程中，对item的定位，交互展示，编辑态等该怎么处理？<br><strong>答：</strong> 对新增数据（newItem）或初始化的数据加入额外标识字段方便管理<br>比如加入这些字段 {key: ‘NEW_TEMP_ID_${this.index}’、isNew: true、editable: true}。<br><code>key</code>:  item定位唯一标识符。list数据增删会造成item定位混乱，给list item加key后无论如何增删编辑item，都可以通过key对item准确定位 。<br><code>isNew</code>: 是用来区分交互的。true为添加item，false为修改item。<br><code>editable</code>：标识是否正在编辑item数据。在进入编辑状态时要cache item原始数据，这样取消编辑还能找回；如果有item数据还处于编辑状态，则无法提交表单，提交时给出相应提示。  </p>
<p><strong>问题2：</strong> 数据校验应该是什么思路？<br><strong>答：</strong> list item数据在保存时就要进行合理性验证，分条逐级校验，这样可以避免表单整体提交时大范围校验的复杂度。</p>
<p><strong>问题3：</strong> 拆分的组件通常包含的方法有哪些？<br><strong>答：</strong><br>常包含的方法有增加、删除、修改、保存，<br>有Modal的话在父组件中还会有 submit行为处理 和 取消submit行为处理的方法，<br>通用的list item定位方法(eg. getRowByKey)。<br>下边列出SkuTable组件渲染之外的代码，供参考：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SkuTable组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">SkuTable</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">index</span> = <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cacheOriginData</span> = &#123;&#125;</span><br><span class="line">    <span class="comment">// 父组件传过来需要有这两个值</span></span><br><span class="line">    <span class="keyword">const</span> &#123; specList = [], skus = [] &#125; = props</span><br><span class="line">    <span class="keyword">const</span> mySkus = <span class="variable language_">this</span>.<span class="title function_">generateMySkus</span>(skus)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">data</span>: mySkus,</span><br><span class="line">      specList,</span><br><span class="line">      <span class="attr">value</span>: mySkus,</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillReceiveProps</span>(<span class="params">nextProps, nextContext</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SkuTable: &#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>, <span class="variable language_">this</span>.<span class="property">props</span>, nextProps)</span><br><span class="line">    <span class="keyword">const</span> &#123; skus, specList &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isEqual</span>(specList, nextProps.<span class="property">specList</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">specList</span>: nextProps.<span class="property">specList</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isEqual</span>(skus, nextProps.<span class="property">skus</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">index</span> = <span class="number">0</span></span><br><span class="line">      <span class="keyword">const</span> mySkus = <span class="variable language_">this</span>.<span class="title function_">generateMySkus</span>(nextProps.<span class="property">skus</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SkuTable111:&#x27;</span>, nextProps.<span class="property">skus</span>, mySkus)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: mySkus,</span><br><span class="line">        <span class="attr">value</span>: mySkus,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">generateMySkus</span>(<span class="params">skus = []</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> skus.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.<span class="property">key</span> = <span class="string">`NEW_TEMP_ID_<span class="subst">$&#123;<span class="variable language_">this</span>.index&#125;</span>`</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">index</span> += <span class="number">1</span></span><br><span class="line">      <span class="keyword">return</span> item</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getRowByKey</span>(<span class="params">key, newData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">return</span> (newData || data).<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">key</span> === key)[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 切换当前行的编辑状态</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">e</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  toggleEditable = <span class="function">(<span class="params">e, key</span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>()</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> newData = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item &#125;))</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">this</span>.<span class="title function_">getRowByKey</span>(key, newData)</span><br><span class="line">    <span class="keyword">if</span> (target) &#123;</span><br><span class="line">      <span class="comment">// 进入编辑状态时保存原始数据</span></span><br><span class="line">      <span class="keyword">if</span> (!target.<span class="property">editable</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cacheOriginData</span>[key] = &#123; ...target &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      target.<span class="property">editable</span> = !target.<span class="property">editable</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">data</span>: newData &#125;)</span><br><span class="line">      <span class="keyword">const</span> &#123; onChange &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        <span class="title function_">onChange</span>(newData)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 新增一项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  newItem = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data = [], specList = [] &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> newData = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item &#125;))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把规格分类转换为新增项的specList数据项</span></span><br><span class="line">    <span class="keyword">const</span> skusSpecList = specList.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">attributeName</span>: item.<span class="property">specCategory</span>,</span><br><span class="line">      <span class="attr">attributeValueName</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;))</span><br><span class="line">    newData.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">`NEW_TEMP_ID_<span class="subst">$&#123;<span class="variable language_">this</span>.index&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">originalPrice</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">currentPrice</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">stock</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">skuCode</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">editable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">isNew</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">specList</span>: skusSpecList || [], <span class="comment">// 类别的列表</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">index</span> += <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">data</span>: newData &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除当前行</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  remove = <span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> newData = data.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">key</span> !== key)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">data</span>: newData &#125;)</span><br><span class="line">    <span class="keyword">const</span> &#123; onChange &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">    <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">      <span class="title function_">onChange</span>(newData)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 处理回车操作，保存当前行</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">e</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">handleKeyPress</span>(<span class="params">e, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">saveRow</span>(e, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleFieldChange</span>(<span class="params">value, fieldName, key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> newData = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item &#125;))</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">this</span>.<span class="title function_">getRowByKey</span>(key, newData)</span><br><span class="line">    <span class="keyword">if</span> (target) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> fieldName === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        target.<span class="property">specList</span>[fieldName].<span class="property">attributeValueName</span> = value</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        target[fieldName] = value</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">data</span>: newData &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 保存当前行</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">e</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  saveRow = <span class="function">(<span class="params">e, key</span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">persist</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">clickedCancel</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clickedCancel</span> = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> target = <span class="variable language_">this</span>.<span class="title function_">getRowByKey</span>(key) || &#123;&#125;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">isInvalid</span> = target =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; isWeightItemShow &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">specList</span>: stateSpecList &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">const</span> &#123; stock, currentPrice, originalPrice, weight &#125; = target</span><br><span class="line">        <span class="keyword">let</span> isSpecInvalid = <span class="literal">false</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;saveRow: &#x27;</span>, target, stateSpecList)</span><br><span class="line">        target.<span class="property">specList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">spec</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!spec.<span class="property">attributeValueName</span>) &#123;</span><br><span class="line">            isSpecInvalid = <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (stateSpecList.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          message.<span class="title function_">error</span>(<span class="string">&#x27;请添加规格后再进行操作&#x27;</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          (!stock &amp;&amp; stock !== <span class="number">0</span>) ||</span><br><span class="line">          (!currentPrice &amp;&amp; currentPrice !== <span class="number">0</span>) ||</span><br><span class="line">          isSpecInvalid ||</span><br><span class="line">          (isWeightItemShow &amp;&amp; !weight &amp;&amp; weight !== <span class="number">0</span>)</span><br><span class="line">        ) &#123;</span><br><span class="line">          message.<span class="title function_">error</span>(<span class="string">&#x27;请检查现价、库存等必填项是否填写&#x27;</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target.<span class="property">currentPrice</span> &gt; target.<span class="property">originalPrice</span>) &#123;</span><br><span class="line">          message.<span class="title function_">error</span>(<span class="string">&#x27;现价不能高于原价&#x27;</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isInvalid</span>(target)) &#123;</span><br><span class="line">        e.<span class="property">target</span>.<span class="title function_">focus</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">delete</span> target.<span class="property">isNew</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">toggleEditable</span>(e, key)</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">      <span class="keyword">const</span> &#123; onChange &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        <span class="title function_">onChange</span>(data)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SkuTable onChange: &#x27;</span>, data)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 取消编辑</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">e</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">cancel</span>(<span class="params">e, key</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">clickedCancel</span> = <span class="literal">true</span></span><br><span class="line">    e.<span class="title function_">preventDefault</span>()</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">const</span> newData = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item &#125;))</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">this</span>.<span class="title function_">getRowByKey</span>(key, newData)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cacheOriginData</span>[key]) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(target, <span class="variable language_">this</span>.<span class="property">cacheOriginData</span>[key])</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">cacheOriginData</span>[key]</span><br><span class="line">    &#125;</span><br><span class="line">    target.<span class="property">editable</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">data</span>: newData &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">clickedCancel</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> getColumns = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 见文章上边</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 见文章上边</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">SkuTable</span></span><br></pre></td></tr></table></figure>
<h1 id="升级为Hooks方案后做的一些改进"><a href="#升级为Hooks方案后做的一些改进" class="headerlink" title="升级为Hooks方案后做的一些改进"></a>升级为Hooks方案后做的一些改进</h1><p>下边我在子组件中主动对父暴露了两个方法（就是说没有通过onChange方法和父组件通信），这样的话父组件可以像前边的Modal一样通过子组件的引用调用到子组建暴露的这两个方法，这样做子组件和父的耦合更小，封装的更好。<br><img src="/2022/05/10/%E5%A4%8D%E6%9D%82%E5%A4%A7%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/4.png"><br>函数组件给父组件暴露方法的方式和类组件不同，核心思路如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef, forwardRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FancyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123; <span class="comment">// 在使用 ref 时自定义暴露给父组件的实例值</span></span><br><span class="line">    <span class="attr">focus</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">showValue</span>: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="number">111</span> + value.<span class="title function_">toString</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewFancyInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">FancyInput</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fancyInputRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          fancyInputRef.current.showValue(true);</span></span><br><span class="line"><span class="language-xml">          fancyInputRef.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      &#125;&gt;点我focus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NewFancyInput</span> <span class="attr">ref</span>=<span class="string">&#123;fancyInputRef&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">NewFancyInput</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过上边的讲解，我相信你已经有了应对大表单的处理思路。实际上上边方法的<strong>扩展性很强</strong>，理论上可以处理任何大的表单，所以你准备好了吗😊。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/10/%E5%8D%81%E4%B8%87%E7%81%AB%E6%80%A5%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BA%94%E5%AF%B9%E4%B9%8B%E7%AD%96%E5%92%8C%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87%E4%B9%8B%E8%B7%AF/" rel="prev" title="十万火急项目的应对之策和技术提升之路">
      <i class="fa fa-chevron-left"></i> 十万火急项目的应对之策和技术提升之路
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/10/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Hooks/" rel="next" title="为什么使用Hooks">
      为什么使用Hooks <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%81%9A"><span class="nav-number">2.</span> <span class="nav-text">怎么做</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BE%E8%AF%81"><span class="nav-number">3.</span> <span class="nav-text">举证</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E6%8B%86%E5%88%86%E5%A4%8D%E7%94%A8%EF%BC%9A"><span class="nav-number">3.1.</span> <span class="nav-text">可拆分复用：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%93%E6%93%8D%E4%BD%9C%E4%BC%B8%E7%BC%A9%EF%BC%9A"><span class="nav-number">3.2.</span> <span class="nav-text">易操作伸缩：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%BD%E7%BB%84%E5%90%88%E9%80%9A%E7%94%A8%EF%BC%9A"><span class="nav-number">3.3.</span> <span class="nav-text">能组合通用：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E8%BF%87%E7%A8%8B%E5%92%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%91%E7%8E%B0-amp-%E5%A4%84%E7%90%86%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">代码编写过程和过程中发现&amp;处理的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7%E4%B8%BAHooks%E6%96%B9%E6%A1%88%E5%90%8E%E5%81%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%B9%E8%BF%9B"><span class="nav-number">5.</span> <span class="nav-text">升级为Hooks方案后做的一些改进</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">taoyingsong</p>
  <div class="site-description" itemprop="description">本博客内容不定期对平时总结的知识进行汇总，交流探讨可+ 微信：StevenTao_</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">taoyingsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '',
      clientSecret: '',
      repo        : '',
      owner       : '',
      admin       : [''],
      id          : 'bea3bd75d3e8b3d45e8b78056c9a05bf',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
