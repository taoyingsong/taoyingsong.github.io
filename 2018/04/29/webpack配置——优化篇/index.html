<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="webpack配置知识梳理">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack配置——优化篇">
<meta property="og:url" content="http://example.com/2018/04/29/webpack%E9%85%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%BC%98%E5%8C%96%E7%AF%87/index.html">
<meta property="og:site_name" content="路漫漫其修远兮&lt;br &#x2F;&gt;吾将上下而求索">
<meta property="og:description" content="webpack配置知识梳理">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-04-29T07:21:31.000Z">
<meta property="article:modified_time" content="2018-04-29T07:36:09.000Z">
<meta property="article:author" content="taoyingsong">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2018/04/29/webpack%E9%85%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%BC%98%E5%8C%96%E7%AF%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>webpack配置——优化篇 | 路漫漫其修远兮<br />吾将上下而求索</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">路漫漫其修远兮<br />吾将上下而求索</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/29/webpack%E9%85%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%BC%98%E5%8C%96%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="taoyingsong">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路漫漫其修远兮<br />吾将上下而求索">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          webpack配置——优化篇
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-04-29 15:21:31 / 修改时间：15:36:09" itemprop="dateCreated datePublished" datetime="2018-04-29T15:21:31+08:00">2018-04-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>webpack配置知识梳理</p>
<span id="more"></span>
<h2 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h2><p>图片压缩、使用 DataURL，以及基本的代码压缩</p>
<h3 id="图片压缩："><a href="#图片压缩：" class="headerlink" title="图片压缩："></a>图片压缩：</h3><p>之前提及使用 file-loader 来处理图片文件，在此基础上，我们再添加一个 image-webpack-loader 来压缩图片文件。<br>image-webpack-loader 的压缩是使用 imagemin 提供的一系列图片压缩类库来处理的，详细查看文档了解。<br>简单的配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // ...</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /.*\.(gif|png|jpe?g|svg|webp)$/i,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: &#x27;file-loader&#x27;,</span><br><span class="line">            options: &#123;&#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: &#x27;image-webpack-loader&#x27;,</span><br><span class="line">            options: &#123;</span><br><span class="line">              mozjpeg: &#123; // 压缩 jpeg 的配置</span><br><span class="line">                progressive: true,</span><br><span class="line">                quality: 65</span><br><span class="line">              &#125;,</span><br><span class="line">              optipng: &#123; // 使用 imagemin-optipng 压缩 png，enable: false 为关闭</span><br><span class="line">                enabled: false,</span><br><span class="line">              &#125;,</span><br><span class="line">              pngquant: &#123; // 使用 imagemin-pngquant 压缩 png</span><br><span class="line">                quality: &#x27;65-90&#x27;,</span><br><span class="line">                speed: 4</span><br><span class="line">              &#125;,</span><br><span class="line">              gifsicle: &#123; // 压缩 gif 的配置</span><br><span class="line">                interlaced: false,</span><br><span class="line">              &#125;,</span><br><span class="line">              webp: &#123; // 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式</span><br><span class="line">                quality: 75</span><br><span class="line">              &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用DataURL"><a href="#使用DataURL" class="headerlink" title="使用DataURL:"></a>使用DataURL:</h3><p>项目中个别不能使用svg图，搞成 CSS Sprites又觉得麻烦，就可以使用这种方式<br>使用url-loader，一般情况仅使用 limit 即可详细查看官方文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // ...</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.(png|jpg|gif)$/,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: &#x27;url-loader&#x27;,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: 8192, // 单位是 Byte，当文件小于 8KB 时将其转换为一个 base64 编码的 DataURL</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码压缩："><a href="#代码压缩：" class="headerlink" title="代码压缩："></a>代码压缩：</h3><p><strong>webpack 4.x</strong> mode 为 production 即会启动压缩 JS 代码的插件。</p>
<p><strong>webpack 3.x</strong><br>Js压缩：JS 的压缩使用uglify插件比较彻底（替换掉长变量等）<br>HTML、CSS压缩：虽然只能移除空格换行等无用字符，但也能在一定程度上减小文件大小。在 webpack 中的配置使用也不是特别麻烦，所以我们通常也会使用。</p>
<p>【对HTML的压缩】在html-webpack-plugin插件配置中。<br>html-webpack-plugin这个插件是使用 html-minifier 来实现 HTML 代码压缩的，minify 下的配置项直接透传给 html-minifier，配置项参考 html-minifier 文档即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // ...</span><br><span class="line">  plugins: [</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      filename: &#x27;index.html&#x27;, // 配置输出文件名和路径</span><br><span class="line">      template: &#x27;assets/index.html&#x27;, // 配置文件模板</span><br><span class="line">      minify: &#123; // 压缩 HTML 的配置</span><br><span class="line">        minifyCSS: true, // 压缩 HTML 中出现的 CSS 代码</span><br><span class="line">        minifyJS: true // 压缩 HTML 中出现的 JS 代码</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【对CSS的压缩】，通过css-loader：<br>css-loader 是使用 cssnano 来压缩代码的，minimize 字段也可以配置为一个对象，来将相关配置传递给 cssnano。更多详细内容请参考 cssnano 官方文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: &#123;</span><br><span class="line">      // ...</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.css/,</span><br><span class="line">        include: [</span><br><span class="line">          path.resolve(__dirname, &#x27;src&#x27;),</span><br><span class="line">        ],</span><br><span class="line">        use: [</span><br><span class="line">          &#x27;style-loader&#x27;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: &#x27;css-loader&#x27;,</span><br><span class="line">            options: &#123;</span><br><span class="line">              minimize: true, // 使用 css 的压缩功能</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="代码分离"><a href="#代码分离" class="headerlink" title="代码分离"></a>代码分离</h2><h3 id="代码分离的原因："><a href="#代码分离的原因：" class="headerlink" title="代码分离的原因："></a>代码分离的原因：</h3><p>在没有异步加载的时候，除去vender.js、manifest.js 其余的css、js会打包到一个js中，此时无论js的小改动还是css的小改动都会在用户刷新页面时重新加载。<br>解决方案：提取公共的css到单独的文件，分离不同模块的js，这样公共css可以缓存，分离的模块虽然里边也有css但是只有这部分修改时只重新加载这部分代码还是能接受的。之所以不把模块的css也分离出来，是因为分离出来后多加载分离的css文件也是一种时间损耗。</p>
<h3 id="webpack-4-x代码分离："><a href="#webpack-4-x代码分离：" class="headerlink" title="webpack 4.x代码分离："></a>webpack 4.x代码分离：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // ... webpack 配置</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: &quot;all&quot;, // 所有的 chunks 代码公共的部分分离出来成为一个单独的文件 commons.js</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上边配置后页面引入commons.js和entry.bundle.js即可，或者使用html-webpack-plugin自动引入，没使用这个插件需要从 stats 的 entrypoints 属性来获取入口应该引用哪些 JS 文件。    </p>
<p><strong>进一步</strong><br>相对于我们写的代码的公共代码，第三方类库的更新频率更低，所以我们可以把这部分代码再单独抽出来一个公共文件，更好的利用缓存。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [&quot;react&quot;, &quot;lodash&quot;, &quot;angular&quot;, ...], // 指定公共使用的第三方类库</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          chunks: &quot;initial”, // 产出的chunks的名字</span><br><span class="line">          test: &quot;vendor&quot;,</span><br><span class="line">          name: &quot;vendor&quot;, // 使用 vendor 入口作为公共部分</span><br><span class="line">          enforce: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // ... 其他配置</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 或者</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          test: /react|angluar|lodash/, // 直接使用 test 来做路径匹配</span><br><span class="line">          chunks: &quot;initial&quot;,</span><br><span class="line">          name: &quot;vendor&quot;,</span><br><span class="line">          enforce: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 或者</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          chunks: &quot;initial&quot;,</span><br><span class="line">          test: path.resolve(__dirname, &quot;node_modules&quot;) // 路径在 node_modules 目录下的都作为公共部分</span><br><span class="line">          name: &quot;vendor&quot;, // 使用 vendor 入口作为公共部分</span><br><span class="line">          enforce: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>上边</strong><br>第一种做法是显示指定哪些类库作为公共部分，<br>第二种做法实现的功能差不多，只是利用了 test 来做模块路径的匹配，<br>第三种做法是把所有在 node_modules 下的模块，即作为依赖安装的，都作为公共部分。<br>你可以针对项目情况，选择最合适的做法。</p>
<h3 id="webpack-3-x代码分离："><a href="#webpack-3-x代码分离：" class="headerlink" title="webpack 3.x代码分离："></a>webpack 3.x代码分离：</h3><p>webpack 3.x 以下的版本需要用到 webpack 自身提供的 CommonsChunkPlugin 插件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // ...</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: &quot;commons&quot;, // 公共使用的 chunk 的名称</span><br><span class="line">      filename: &quot;commons.js&quot;, // 公共 chunk 的生成文件名</span><br><span class="line">      minChunks: 3, // 公共的部分必须被 3 个 chunk 共享</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>chunk 在这里是构建的主干，可以简单理解为【一个入口对应一个 chunk】。</p>
<p>以上插件配置在构建后会生成一个 commons.js 文件，该文件就是代码中的公共部分。上面的配置中 minChunks 字段为 3，【该字段的意思是当一个模块被 3 个以上的 chunk 依赖时，这个模块就会被划分到 commons chunk 中去】。单从这个配置的角度上讲，这种方式并没有 4.x 的 chunks: “all” 那么方便。</p>
<p><strong>进一步</strong><br>提取共享类库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [&#x27;react&#x27;, &#x27;react-redux&#x27;], // 指定公共使用的第三方类库</span><br><span class="line">    app: &#x27;./src/entry&#x27;,</span><br><span class="line">    // ...</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: &#x27;vendor&#x27; // 使用 vendor 入口作为公共部分</span><br><span class="line">      filename: &quot;vendor.js&quot;, </span><br><span class="line">      minChunks: Infinity, // 这个配置会让 webpack 不再自动抽离公共模块，如果这里和之前一样依旧设置为 3，那么被 3 个以上的 chunk 依赖的模块会和 React、React-Redux 一同打包进 vendor，这样就失去显式指定的意义了。</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>minChunks其实还可以是一个函数，如：<br>该函数在分析每一个依赖的时候会被调用，可以在函数中针对每一个模块做更加精细化的控制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// module: 传入当前依赖模块的信息 </span><br><span class="line">// count: 被作为公共模块的数量</span><br><span class="line">minChunks: (module, count) =&gt; &#123;</span><br><span class="line">  console.log(module, count);</span><br><span class="line">  return true;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Demo:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">minChunks: (module, count) =&gt; &#123;</span><br><span class="line">  return module.context &amp;&amp; module.context.includes(&quot;node_modules&quot;); </span><br><span class="line">  // node_modules 目录下的模块都作为公共部分，效果就如同 webpack 4.x 中的 test: path.resolve(__dirname, &quot;node_modules&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其余详见文档</p>
<h2 id="进一步控制JS大小"><a href="#进一步控制JS大小" class="headerlink" title="进一步控制JS大小"></a>进一步控制JS大小</h2><h3 id="模块按需加载："><a href="#模块按需加载：" class="headerlink" title="模块按需加载："></a>模块按需加载：</h3><p>要按需加载代码模块很简单，遵循 ES 标准的动态加载语法 dynamic-import 来编写代码即可，webpack 会自动处理使用该语法编写的模块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// import 作为一个方法使用，传入模块名即可，返回一个 promise 来获取模块暴露的对象</span><br><span class="line">// 注释 webpackChunkName: &quot;lodash&quot; 可以用于指定 chunk 的名称，在输出文件时有用</span><br><span class="line">// 输出文件是在 webpack 配置中添加一个 output.chunkFilename 的配置</span><br><span class="line">import(/* webpackChunkName: &quot;lodash&quot; */ &#x27;lodash&#x27;).then((_) =&gt; &#123; </span><br><span class="line">  console.log(_.lash([1, 2, 3])) // 打印 3</span><br><span class="line">&#125;)</span><br><span class="line">output: &#123;</span><br><span class="line">  path: path.resolve(__dirname, &#x27;dist&#x27;),</span><br><span class="line">  filename: &#x27;[name].[hash:8].js&#x27;,</span><br><span class="line">  chunkFilename: &#x27;[name].[hash:8].js&#x27; // 指定分离出来的代码文件的名称， 这样就会输出结果中就有一个对应上边注释中loadash的文件名字。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有添加注释 webpackChunkName: “lodash” 以及 output.chunkFilename 配置，那么分离出来的文件名称会以简单数字的方式标识，不便于识别。<br>注意一下，如果你使用了 Babel 的话，还需要 Syntax Dynamic Import 这个 Babel 插件来处理 import() 这种语法。<br>由于动态加载代码模块的语法依赖于 promise，对于低版本的浏览器，需要添加 promise 的 polyfill 后才能使用。<br>动态加载代码时依赖于网络，其模块内容会异步返回，所以 import 方法是返回一个 promise 来获取动态加载的模块内容。</p>
<h3 id="Tree-shaking"><a href="#Tree-shaking" class="headerlink" title="Tree shaking"></a>Tree shaking</h3><p>可以移除 JavaScript 上下文中的未引用代码，删掉用不着的代码，能够有效减少 JS 代码文件的大小。<br>在 webpack 中，只有启动了 JS 代码压缩功能（即使用 uglify）时，会做 Tree shaking 的优化。webpack 4.x 需要指定 mode 为 production。</p>
<p>如果你在项目中使用了 Babel 的话，要把 Babel 解析模块语法的功能关掉，在 .babelrc 配置中增加 “modules”: false 这个配置，这样可以把 import&#x2F;export 的这一部分模块语法交由 webpack 处理，否则没法使用 Tree shaking 的优化。    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [[&quot;env&quot;, &#123; &quot;modules&quot;: false &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// 下边启动了Tree shaking之后，构建出来的结果就会移除 square 的那一部分代码了。</span><br><span class="line">// src/math.js</span><br><span class="line">export function square(x) &#123;</span><br><span class="line">  return x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function cube(x) &#123;</span><br><span class="line">  return x * x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// src/index.js</span><br><span class="line">import &#123; cube &#125; from &#x27;./math.js&#x27; // 在这里只是引用了 cube 这个方法</span><br><span class="line"></span><br><span class="line">console.log(cube(3))</span><br><span class="line"></span><br><span class="line">有的时候你启用了 Tree shaking 功能，但是发现好像并没有什么用，例如：</span><br><span class="line"></span><br><span class="line">// src/component.js</span><br><span class="line">export class Person &#123;</span><br><span class="line">  constructor (&#123; name &#125;) &#123;</span><br><span class="line">    this.name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getName () &#123;</span><br><span class="line">    return this.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export class Apple &#123;</span><br><span class="line">  constructor (&#123; model &#125;) &#123;</span><br><span class="line">    this.model = model</span><br><span class="line">  &#125;</span><br><span class="line">  getModel () &#123;</span><br><span class="line">    return this.model</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// src/index.js</span><br><span class="line">import &#123; Apple &#125; from &#x27;./components&#x27;</span><br><span class="line"></span><br><span class="line">const appleModel = new Apple(&#123;</span><br><span class="line">  model: &#x27;X&#x27;</span><br><span class="line">&#125;).getModel()</span><br><span class="line"></span><br><span class="line">console.log(appleModel)</span><br></pre></td></tr></table></figure>
<p>打包压缩后还是可以发现，Person 这一块看起来没用到的代码出现在文件中。现在如果你在 Babel 配置中增加 “loose”: true 配置的话，Person 这一块代码就可以在构建时移除掉了。相关问题自行搜索。</p>
<h3 id="sideEffects"><a href="#sideEffects" class="headerlink" title="sideEffects"></a>sideEffects</h3><p>webpack 4.x 才具备的特性<br>现在 lodash 的 ES 版本 的 package.json 文件中已经有 sideEffects: false 这个声明了，当某个模块的 package.json 文件中有了这个声明之后，webpack 会认为这个模块没有任何副作用，只是单纯用来对外暴露模块使用，那么在打包的时候就会做一些额外的处理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; forEach, includes &#125; from &#x27;lodash-es&#x27;</span><br><span class="line"></span><br><span class="line">forEach([1, 2], (item) =&gt; &#123;</span><br><span class="line">  console.log(item)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(includes([1, 2, 3], 1))</span><br><span class="line">由于 lodash-es 这个模块的 package.json 文件有 sideEffects: false 的声明，所以 webpack 会将上述的代码转换为以下的代码去处理：</span><br><span class="line">import &#123; default as forEach &#125; from &#x27;lodash-es/forEach&#x27;</span><br><span class="line">import &#123; default as includes &#125; from &#x27;lodash-es/includes&#x27;</span><br><span class="line"></span><br><span class="line">// ... 其他代码</span><br></pre></td></tr></table></figure>
<p>最终 webpack 不会把 lodash-es 所有的代码内容打包进来，只是打包了你用到的那两个方法，这便是 sideEffects 的作用。</p>
<h2 id="提升-webpack-的构建速度"><a href="#提升-webpack-的构建速度" class="headerlink" title="提升 webpack 的构建速度"></a>提升 webpack 的构建速度</h2><ul>
<li>减少 resolve 的解析</li>
<li>减少 plugin 的消耗</li>
<li>换种方式处理图片</li>
<li>使用 DLLPlugin</li>
<li>积极更新 webpack 版本</li>
</ul>
<h3 id="减少-resolve-的解析"><a href="#减少-resolve-的解析" class="headerlink" title="减少 resolve 的解析"></a>减少 resolve 的解析</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">modules: [</span><br><span class="line">    path.resolve(__dirname, &#x27;node_modules&#x27;), // 使用绝对路径指定 node_modules，不做过多查询</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // 删除不必要的后缀自动补全，少了文件后缀的自动匹配，即减少了文件路径查询的工作</span><br><span class="line">  // 其他文件可以在编码时指定后缀，如 import(&#x27;./index.scss&#x27;)</span><br><span class="line">  extensions: [&quot;.js&quot;], </span><br><span class="line"></span><br><span class="line">  // 避免新增默认文件，编码时使用详细的文件路径，代码会更容易解读，也有益于提高构建速度</span><br><span class="line">  mainFiles: [&#x27;index&#x27;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在编码时，如果是使用我们自己本地的代码模块，尽可能编写完整的路径，避免使用目录名，如：import ‘.&#x2F;lib&#x2F;slider&#x2F;index.js’</p>
<h3 id="把-loader-应用的文件范围缩小"><a href="#把-loader-应用的文件范围缩小" class="headerlink" title="把 loader 应用的文件范围缩小"></a>把 loader 应用的文件范围缩小</h3><p>尽可能把 loader 应用的文件范围缩小，只在最少数必须的代码模块中去使用必要的 loader<br>例如 node_modules 目录下的其他依赖类库文件，基本就是直接编译好可用的代码，无须再经过 loader 处理了<br>如果没有配置 include，所有的外部依赖模块都经过 Babel 处理的话，构建速度也是会收很大影响的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rules: [ </span><br><span class="line">  &#123;</span><br><span class="line">    test: /\.jsx?/,</span><br><span class="line">    include: [ </span><br><span class="line">      path.resolve(__dirname, &#x27;src&#x27;), </span><br><span class="line">      // 限定只在 src 目录下的 js/jsx 文件需要经 babel-loader 处理</span><br><span class="line">      // 通常我们需要 loader 处理的文件都是存放在 src 目录</span><br><span class="line">    ],</span><br><span class="line">    use: &#x27;babel-loader&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="减少-plugin-的消耗"><a href="#减少-plugin-的消耗" class="headerlink" title="减少 plugin 的消耗"></a>减少 plugin 的消耗</h3><p>webpack 的 plugin 会在构建的过程中加入其它的工作步骤，如果可以的话，适当地移除掉一些没有必要的 plugin。</p>
<p>这里再提一下 webpack 4.x 的 mode，区分 mode 会让 webpack 的构建更加有针对性，更加高效。例如当 mode 为 development 时，webpack 会避免使用一些提高应用代码加载性能的配置项，如 UglifyJsPlugin，ExtractTextPlugin 等，这样可以更快地启动开发环境的服务，而当 mode 为 production 时，webpack 会避免使用一些便于 debug 的配置，来提升构建时的速度，例如极其消耗性能的 Source Maps 支持。</p>
<h3 id="换种方式处理图片"><a href="#换种方式处理图片" class="headerlink" title="换种方式处理图片"></a>换种方式处理图片</h3><p>之前我们用webpack 的 image-webpack-loader 来压缩图片<br>换一种思路，我们可以直接使用 imagemin 来做图片压缩，编写简单的命令即可。然后使用 pre-commit 这个类库来配置对应的命令，使其在 git commit 的时候触发，并且将要提交的文件替换为压缩后的文件。<br>这样提交到代码仓库的图片就已经是压缩好的了，以后在项目中再次使用到的这些图片就无需再进行压缩处理了，image-webpack-loader 也就没有必要了。</p>
<h3 id="使用-DLLPlugin"><a href="#使用-DLLPlugin" class="headerlink" title="使用 DLLPlugin"></a>使用 DLLPlugin</h3><p>DLLPlugin 是 webpack 官方提供的一个插件，也是用来分离代码的，和 optimization.splitChunks（3.x 版本的是 CommonsChunkPlugin）有异曲同工之妙，如果项目不涉及性能优化这一块，基本上使用 optimization.splitChunks 即可。<br>使用DLLPlugin需要额外的一个构建配置，用来打包公共的那一部分代码，举个例子，假设这个额外配置是 webpack.dll.config.js：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  name: &#x27;vendor&#x27;,</span><br><span class="line">  entry: [&#x27;lodash&#x27;], // 这个例子我们打包 lodash 作为公共类库</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, &quot;dist&quot;),</span><br><span class="line">    filename: &quot;vendor.js&quot;,</span><br><span class="line">    library: &quot;vendor_[hash]&quot; // 打包后对外暴露的类库名称</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.DllPlugin(&#123;</span><br><span class="line">      name: &#x27;vendor_[hash]&#x27;,</span><br><span class="line">      path: path.resolve(__dirname, &quot;dist/manifest.json&quot;), // 使用 DLLPlugin 在打包的时候生成一个 manifest 文件</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在我们原来的webpack配置中添加一个webpack.DllReferencePlugin 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.DllReferencePlugin(&#123;</span><br><span class="line">      manifest: path.resolve(__dirname, &#x27;dist/manifest.json&#x27;), </span><br><span class="line">      // 指定需要用到的 manifest 文件，</span><br><span class="line">      // webpack 会根据这个 manifest 文件的信息，分析出哪些模块无需打包，直接从另外的文件暴露出来的内容中获取</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在构建的时候，我们需要优先使用 webpack.dll.config.js 来打包，如 webpack -c webpack.dll.config.js –mode production，构建后生成公共代码模块的文件 vendor.js 和 manifest.json，然后再进行应用代码的构建。</p>
<p>你会发现构建结果的应用代码中不包含 lodash 的代码内容，这一部分代码内容会放在 vendor.js 这个文件中，DLLPlugin 构建出来的内容无需每次都重新构建，后续应用代码部分变更时，你不用再执行配置为 webpack.dll.config.js 这一部分的构建，沿用原本的构建结果即可，所以相比 optimization.splitChunks，使用 DLLPlugin 时，构建速度是会有显著提高的。<br>但是当你升级 lodash（即你的公共部分代码的内容变更）时，要重新去执行 webpack.dll.config.js 这一部分的构建，不然沿用的依旧是旧的构建结果，使用上并不如 optimization.splitChunks 来得方便。</p>
<p>还有一点需要注意的是，html-webpack-plugin 并不会自动处理 DLLPlugin 分离出来的那个公共代码文件，我们需要自己处理这一部分的内容，可以考虑使用 add-asset-html-webpack-plugin，详见文档</p>
<h3 id="webpack-4-x-的构建性能"><a href="#webpack-4-x-的构建性能" class="headerlink" title="webpack 4.x 的构建性能"></a>webpack 4.x 的构建性能</h3><p>webpack 4.0 版本做了很多关于提升构建性能的工作</p>
<ul>
<li>AST 可以直接从 loader 直接传递给 webpack，避免额外的解析，对这一个优化细节有兴趣的可以查看这个 PR。</li>
<li>使用速度更快的 md4 作为默认的 hash 方法，对于大型项目来说，文件一多，需要 hash 处理的内容就多，webpack 的 hash 处理优化对整体的构建速度提升应该还是有一定的效果的。</li>
<li>Node 语言层面的优化，如用 for of 替换 forEach，用 Map 和 Set 替换普通的对象字面量等等，这一部分就不展开讲了，有兴趣的同学可以去 webpack 的 PRs 寻找更多的内容。</li>
<li>默认开启 uglifyjs-webpack-plugin 的 cache 和 parallel，即缓存和并行处理，这样能大大提高 production mode 下压缩代码的速度。<br>除此之外，还有比较琐碎的一些内容，可以查阅：webpack release 4.0，留意 performance 关键词。</li>
</ul>
<p>可以看出4.x 的构建性能对比 3.x 是有很显著的提高，而 webpack 官方后续计划加入多核运算，持久化缓存等特性来进一步提升性能（可能要等到 5.x 版本了），所以，及时更新 webpack 版本，也是提升构建性能的一个有效方式。</p>
<p>另外当我们面对因项目过大而导致的构建性能问题时，我们也可以换个角度，思考在 webpack 之上的另外一些解决方案，不要过分依赖于 webpack。</p>
<p>ps.<br>webpack4.x新增了 mode 参数（4.x 是必要的参数）<br>webpack5.x后增加对CSS、HTML模块类型的支持：</p>
<ul>
<li>CSS 模块类型的支持，可以用 CSS 文件作为入口</li>
<li>HTML 模块类型的支持，可以用 HTML 文件作为入口</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/webpack/" rel="tag"># webpack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/04/29/webpack%E9%85%8D%E7%BD%AE%E2%80%94%E2%80%94%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="prev" title="webpack配置——基础篇">
      <i class="fa fa-chevron-left"></i> webpack配置——基础篇
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/05/07/vue%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/" rel="next" title="vue运行原理">
      vue运行原理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9"><span class="nav-number">1.</span> <span class="nav-text">压缩</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%EF%BC%9A"><span class="nav-number">1.1.</span> <span class="nav-text">图片压缩：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8DataURL"><span class="nav-number">1.2.</span> <span class="nav-text">使用DataURL:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9%EF%BC%9A"><span class="nav-number">1.3.</span> <span class="nav-text">代码压缩：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB"><span class="nav-number">2.</span> <span class="nav-text">代码分离</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">代码分离的原因：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-4-x%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">webpack 4.x代码分离：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-3-x%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%EF%BC%9A"><span class="nav-number">2.3.</span> <span class="nav-text">webpack 3.x代码分离：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%8E%A7%E5%88%B6JS%E5%A4%A7%E5%B0%8F"><span class="nav-number">3.</span> <span class="nav-text">进一步控制JS大小</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%EF%BC%9A"><span class="nav-number">3.1.</span> <span class="nav-text">模块按需加载：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tree-shaking"><span class="nav-number">3.2.</span> <span class="nav-text">Tree shaking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sideEffects"><span class="nav-number">3.3.</span> <span class="nav-text">sideEffects</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%8D%87-webpack-%E7%9A%84%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6"><span class="nav-number">4.</span> <span class="nav-text">提升 webpack 的构建速度</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%8F%E5%B0%91-resolve-%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="nav-number">4.1.</span> <span class="nav-text">减少 resolve 的解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%8A-loader-%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E8%8C%83%E5%9B%B4%E7%BC%A9%E5%B0%8F"><span class="nav-number">4.2.</span> <span class="nav-text">把 loader 应用的文件范围缩小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%8F%E5%B0%91-plugin-%E7%9A%84%E6%B6%88%E8%80%97"><span class="nav-number">4.3.</span> <span class="nav-text">减少 plugin 的消耗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%A2%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%A4%84%E7%90%86%E5%9B%BE%E7%89%87"><span class="nav-number">4.4.</span> <span class="nav-text">换种方式处理图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-DLLPlugin"><span class="nav-number">4.5.</span> <span class="nav-text">使用 DLLPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-4-x-%E7%9A%84%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD"><span class="nav-number">4.6.</span> <span class="nav-text">webpack 4.x 的构建性能</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">taoyingsong</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">taoyingsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '',
      clientSecret: '',
      repo        : '',
      owner       : '',
      admin       : [''],
      id          : 'c5a9d61e2e529bd2f585e6aab820f6b8',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
